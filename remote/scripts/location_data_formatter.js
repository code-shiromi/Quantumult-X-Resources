/* References: https://raw.githubusercontent.com/crossutility/Quantumult-X/master/sample-location-with-script.js, https://raw.githubusercontent.com/KOP-XIAO/QuantumultX/master/Scripts/IP_API.js
 * Geo-IP API provider: ipinfo.io
 * Example from http://ipinfo.io/json
{
    "ip": "0.0.0.0",
    "hostname": "",
    "city": "Japan",
    "region": "Tokyo",
    "country": "JP",
    "loc": "",
    "org": "",
    "timezone": "Asia/Japan",
    "readme": "https://ipinfo.io/missingauth"
} */

if ($response.statusCode != 200) {
    $done(Null);
}

var flags = new Map([["AC","ğŸ‡¦ğŸ‡¨"], ["AE","ğŸ‡¦ğŸ‡ª"], ["AF","ğŸ‡¦ğŸ‡«"], ["AI","ğŸ‡¦ğŸ‡®"], ["AL","ğŸ‡¦ğŸ‡±"], ["AM","ğŸ‡¦ğŸ‡²"], ["AQ","ğŸ‡¦ğŸ‡¶"], ["AR","ğŸ‡¦ğŸ‡·"], ["AS","ğŸ‡¦ğŸ‡¸"], ["AT","ğŸ‡¦ğŸ‡¹"], ["AU","ğŸ‡¦ğŸ‡º"], ["AW","ğŸ‡¦ğŸ‡¼"], ["AX","ğŸ‡¦ğŸ‡½"], ["AZ","ğŸ‡¦ğŸ‡¿"], ["BA","ğŸ‡§ğŸ‡¦"], ["BB","ğŸ‡§ğŸ‡§"], ["BD","ğŸ‡§ğŸ‡©"], ["BE","ğŸ‡§ğŸ‡ª"], ["BF","ğŸ‡§ğŸ‡«"], ["BG","ğŸ‡§ğŸ‡¬"], ["BH","ğŸ‡§ğŸ‡­"], ["BI","ğŸ‡§ğŸ‡®"], ["BJ","ğŸ‡§ğŸ‡¯"], ["BM","ğŸ‡§ğŸ‡²"], ["BN","ğŸ‡§ğŸ‡³"], ["BO","ğŸ‡§ğŸ‡´"], ["BR","ğŸ‡§ğŸ‡·"], ["BS","ğŸ‡§ğŸ‡¸"], ["BT","ğŸ‡§ğŸ‡¹"], ["BV","ğŸ‡§ğŸ‡»"], ["BW","ğŸ‡§ğŸ‡¼"], ["BY","ğŸ‡§ğŸ‡¾"], ["BZ","ğŸ‡§ğŸ‡¿"], ["CA","ğŸ‡¨ğŸ‡¦"], ["CF","ğŸ‡¨ğŸ‡«"], ["CH","ğŸ‡¨ğŸ‡­"], ["CK","ğŸ‡¨ğŸ‡°"], ["CL","ğŸ‡¨ğŸ‡±"], ["CM","ğŸ‡¨ğŸ‡²"], ["CN","ğŸ‡¨ğŸ‡³"], ["CO","ğŸ‡¨ğŸ‡´"], ["CP","ğŸ‡¨ğŸ‡µ"], ["CR","ğŸ‡¨ğŸ‡·"], ["CU","ğŸ‡¨ğŸ‡º"], ["CV","ğŸ‡¨ğŸ‡»"], ["CW","ğŸ‡¨ğŸ‡¼"], ["CX","ğŸ‡¨ğŸ‡½"], ["CY","ğŸ‡¨ğŸ‡¾"], ["CZ","ğŸ‡¨ğŸ‡¿"], ["DE","ğŸ‡©ğŸ‡ª"], ["DG","ğŸ‡©ğŸ‡¬"], ["DJ","ğŸ‡©ğŸ‡¯"], ["DK","ğŸ‡©ğŸ‡°"], ["DM","ğŸ‡©ğŸ‡²"], ["DO","ğŸ‡©ğŸ‡´"], ["DZ","ğŸ‡©ğŸ‡¿"], ["EA","ğŸ‡ªğŸ‡¦"], ["EC","ğŸ‡ªğŸ‡¨"], ["EE","ğŸ‡ªğŸ‡ª"], ["EG","ğŸ‡ªğŸ‡¬"], ["EH","ğŸ‡ªğŸ‡­"], ["ER","ğŸ‡ªğŸ‡·"], ["ES","ğŸ‡ªğŸ‡¸"], ["ET","ğŸ‡ªğŸ‡¹"], ["EU","ğŸ‡ªğŸ‡º"], ["FI","ğŸ‡«ğŸ‡®"], ["FJ","ğŸ‡«ğŸ‡¯"], ["FK","ğŸ‡«ğŸ‡°"], ["FM","ğŸ‡«ğŸ‡²"], ["FO","ğŸ‡«ğŸ‡´"], ["FR","ğŸ‡«ğŸ‡·"], ["GA","ğŸ‡¬ğŸ‡¦"], ["GB","ğŸ‡¬ğŸ‡§"], ["GE","ğŸ‡¬ğŸ‡ª"], ["GR","ğŸ‡¬ğŸ‡·"], ["HK","ğŸ‡­ğŸ‡°"], ["HR","ğŸ‡­ğŸ‡·"] ,["HU","ğŸ‡­ğŸ‡º"], ["ID","ğŸ‡®ğŸ‡©"], ["IE","ğŸ‡®ğŸ‡ª"], ["IL","ğŸ‡®ğŸ‡±"], ["IM","ğŸ‡®ğŸ‡²"], ["IN","ğŸ‡®ğŸ‡³"], ["IR","ğŸ‡®ğŸ‡·"] ,["IS","ğŸ‡®ğŸ‡¸"], ["IT","ğŸ‡®ğŸ‡¹"], ["JO","ğŸ‡¯ğŸ‡´"], ["JP","ğŸ‡¯ğŸ‡µ"], ["KE","ğŸ‡°ğŸ‡ª"], ["KG","ğŸ‡°ğŸ‡¬"], ["KH","ğŸ‡°ğŸ‡­"], ["KR","ğŸ‡°ğŸ‡·"], ["KZ","ğŸ‡°ğŸ‡¿"], ["LT","ğŸ‡±ğŸ‡¹"], ["LU","ğŸ‡±ğŸ‡º"], ["LV","ğŸ‡±ğŸ‡»"] ,["MA","ğŸ‡²ğŸ‡¦"], ["MD","ğŸ‡²ğŸ‡©"], ["MK","ğŸ‡²ğŸ‡°"], ["MN","ğŸ‡²ğŸ‡³"], ["MO","ğŸ‡²ğŸ‡´"], ["MX","ğŸ‡²ğŸ‡½"], ["MY","ğŸ‡²ğŸ‡¾"] ,["NG","ğŸ‡³ğŸ‡¬"], ["NL","ğŸ‡³ğŸ‡±"], ["NO","ğŸ‡³ğŸ‡´"], ["NP","ğŸ‡³ğŸ‡µ"], ["NZ","ğŸ‡³ğŸ‡¿"], ["PA","ğŸ‡µğŸ‡¦"], ["PE","ğŸ‡µğŸ‡ª"], ["PH","ğŸ‡µğŸ‡­"], ["PK","ğŸ‡µğŸ‡°"], ["PL","ğŸ‡µğŸ‡±"], ["PT","ğŸ‡µğŸ‡¹"], ["RO","ğŸ‡·ğŸ‡´"], ["RS","ğŸ‡·ğŸ‡¸"], ["RU","ğŸ‡·ğŸ‡º"], ["RW","ğŸ‡·ğŸ‡¼"], ["SA","ğŸ‡¸ğŸ‡¦"], ["SB","ğŸ‡¸ğŸ‡§"], ["SC","ğŸ‡¸ğŸ‡¨"], ["SD","ğŸ‡¸ğŸ‡©"], ["SE","ğŸ‡¸ğŸ‡ª"], ["SG","ğŸ‡¸ğŸ‡¬"], ["SI","ğŸ‡¸ğŸ‡®"], ["SK","ğŸ‡¸ğŸ‡°"], ["TH","ğŸ‡¹ğŸ‡­"], ["TN","ğŸ‡¹ğŸ‡³"], ["TO","ğŸ‡¹ğŸ‡´"], ["TR","ğŸ‡¹ğŸ‡·"], ["TV","ğŸ‡¹ğŸ‡»"], ["TW","ğŸ‡¹ğŸ‡¼"], ["UA","ğŸ‡ºğŸ‡¦"], ["UK","ğŸ‡¬ğŸ‡§"], ["UM","ğŸ‡ºğŸ‡²"], ["US","ğŸ‡ºğŸ‡¸"], ["UY","ğŸ‡ºğŸ‡¾"], ["UZ","ğŸ‡ºğŸ‡¿"], ["VA","ğŸ‡»ğŸ‡¦"], ["VE","ğŸ‡»ğŸ‡ª"], ["VG","ğŸ‡»ğŸ‡¬"], ["VI","ğŸ‡»ğŸ‡®"], ["VN","ğŸ‡»ğŸ‡³"], ["ZA","ğŸ‡¿ğŸ‡¦"]]);
var body = $response.body;
var obj = JSON.parse(body);
var flag = flags.get(obj['country']);

var ip = obj['ip'];
var title = flag + ' ' + obj['city'];
var subtitle = 'ISP: ' + obj['org'];
var description = 'Server location: ' + flag + ' ' + obj['region'] + '\n' + 'IP: ' + ip + '\n' + 'ISP: ' + obj['org'];

$done({title, subtitle, ip, description});